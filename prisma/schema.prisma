generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

model User {
  id                 String               @id @default(cuid())
  name               String
  email              String               @unique
  emailVerified      DateTime?            @map("email_verified")
  password           String
  phoneNumber        String               @unique
  gender             Gender
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  VerificationToken  VerificationToken[]
  PasswordResetToken PasswordResetToken[]
  Budget             Budget[]
  ChatMessage        ChatMessage[]

  @@map("users")
}

model VerificationToken {
  id        String   @id @default(cuid())
  email     String   @unique
  token     String   @unique
  expiresAt DateTime
  user      User     @relation(fields: [email], references: [email], onDelete: Cascade)

  @@unique([email, token])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  user      User     @relation(fields: [email], references: [email], onDelete: Cascade)

  @@unique([email, token])
}

// ------------------------------
// Budget Model (monthly or goal-based)
// ------------------------------
model Budget {
  id            String        @id @default(cuid())
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String
  month         String
  totalIncome   Float         @default(0)
  totalExpenses Float         @default(0)
  savingsGoal   Float         @default(0)
  actualSavings Float         @default(0)
  aiAdvice      String? // AI-generated text
  incomes       Income[]
  expenses      Expense[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([userId])
}

// ------------------------------
// Income Model
// ------------------------------
model Income {
  id       String   @id @default(cuid())
  budget   Budget   @relation(fields: [budgetId], references: [id], onDelete: Cascade)
  budgetId String
  source   String
  amount   Float
  date     DateTime @default(now())

  @@index([budgetId])
}

// ------------------------------
// Expense Model
// ------------------------------
model Expense {
  id       String   @id @default(cuid())
  budget   Budget   @relation(fields: [budgetId], references: [id], onDelete: Cascade)
  budgetId String
  category String
  amount   Float
  date     DateTime @default(now())

  @@index([budgetId])
}

// ------------------------------
// Chat Message Model
// ------------------------------
model ChatMessage {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  message   String
  response  String
  createdAt DateTime @default(now())

  @@index([userId])
}

